{% extends '_main.html' %}

{% block title %}Series - Bazarr{% endblock %}

{% block head %}

{% endblock head %}

{% block body %}
<table id="series" class="mdl-data-table" style="width:100%">
	<thead>
		<tr>
			<th>Name</th>
			<th>Exist</th>
			<th>Audio Language</th>
			<th>Subtitles Languages</th>
			<th>Hearing-Impaired</th>
			<th>Forced</th>
			<th>Subtitles</th>
		</tr>
	</thead>
</table>
{% endblock body %}

{% block tail %}
<script>
	$(document).ready(function() {
        var table = $('#series').DataTable( {
            "processing": true,
            "serverSide": true,
			"searching": false,
			"ordering": false,
			"lengthChange": false,
            "ajax": "/api/series",
            "columns": [
            { "data": "title" },
            { "data": "exist",
				"render": function ( data ) {
				    if (data === false) {
				    	return '<i class="fas fa-exclamation-triangle" data-toggle="tooltip" data-placement="right" title="This path doesn\'t seem to be valid."></i>';
					} else if (data === true) {
				    	return '<i class="fas fa-check" data-toggle="tooltip" data-placement="right" title="This path seems to be valid."></i>';
					}
				}
			},
            { "data": "audio_language.name" },
            { "data": "languages",
				"render": function ( data ) {
            		if (data !== 'None') {
						var languages = '';
						data.forEach(appendFunc);
						return languages;
					} else {
            			return null;
					}

            		function appendFunc(value) {
            			languages = languages + '<span class="badge badge-secondary" data-toggle="tooltip" data-placement="right" title="'+value.name+'">'+value.code2+'</span> ';
					}
				}
			},
            { "data": "hearing_impaired" },
            { "data": "forced" },
            { "data": null,
				"render": function ( data ) {
            		var total = data.episodeFileCount;
            		var completed = data.episodeFileCount - data.episodeMissingCount;
            		var completed_style = '';
					var completed_text = '';
					if (completed/total*100 > 0 && data.languages !== 'None') {
						completed_style = ' style="width: '+completed/total*100+'%;"';
						completed_text = completed+'/'+total;
					}
            		return '<div class="progress"><div class="progress-bar" role="progressbar"'+completed_style+' aria-valuenow="'+completed+'" aria-valuemin="0" aria-valuemax="'+total+'">'+completed_text+'</div></div>'
				}
			}
            ]
        } );
    } );
</script>
{% endblock tail %}
